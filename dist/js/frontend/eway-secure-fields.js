!function(){"use strict";var e=window.wp.i18n;const t={ewayFields:{},iframeContainers:{},fields:{nameFieldConfig:{publicApiKey:null,fieldDivId:"eway-secure-field-name",fieldType:"name",styleTemplateId:"wc-eway-credit-card-field-placeholder"},cardFieldConfig:{publicApiKey:null,fieldDivId:"eway-secure-field-card",fieldType:"card",styleTemplateId:"wc-eway-credit-card-field-placeholder"},expiryFieldConfig:{publicApiKey:null,fieldDivId:"eway-secure-field-expiry",fieldType:"expirytext",styleTemplateId:"wc-eway-credit-card-field-placeholder"},cvnFieldConfig:{publicApiKey:null,fieldDivId:"eway-secure-field-cvn",fieldType:"cvn",styleTemplateId:"wc-eway-credit-card-field-placeholder"}},setupAllSecureFields:e=>{if(!e)throw new Error("Eway public API key is required.");t.setEwayPublicApiKey(e),eWAYUtils.setVar("activeFields",[]),eWAY.setupSecureField(t.fields.nameFieldConfig,t.secureFieldCallback),eWAY.setupSecureField(t.fields.cardFieldConfig,t.secureFieldCallback),eWAY.setupSecureField(t.fields.expiryFieldConfig,t.secureFieldCallback),eWAY.setupSecureField(t.fields.cvnFieldConfig,t.secureFieldCallback),t.watchEwaySecureFieldsLoadingProgress()},secureFieldCallback:e=>{if(!e.fieldValid)throw new Error(e.errors);const c=document.getElementById("securefieldcode"),r=c.closest("fieldset"),o={type:"card"===e.targetField?"number":e.targetField};e.valueIsValid||r.dispatchEvent(new CustomEvent("wcEwaySecureFieldsValidationFail",{detail:o})),e.valueIsValid&&r.dispatchEvent(new CustomEvent("wcEwaySecureFieldsValidationSuccess",{detail:o})),t.ewayFields[e.targetField]=e,c.value=e.secureFieldCode,c.dispatchEvent(new Event("change"))},watchEwaySecureFieldsLoadingProgress:()=>{eWAYUtils.getVar("activeFields").forEach((e=>{const{iframe:c,fieldType:r}=e,o=()=>{window.clearTimeout(n),t.iframeContainers[r].isLoaded=!0},n=window.setTimeout((()=>{t.iframeContainers[r].isLoaded=!0,c.removeEventListener("load",o)}),1e3);t.iframeContainers[r]={iframe:c,isLoaded:!1},c.addEventListener("load",o)}));const e=window.setInterval((()=>{Object.values(t.iframeContainers).every((e=>{let{isLoaded:t}=e;return t}))&&(window.clearInterval(e),document.dispatchEvent(new Event("wcEwaySecureFieldsLoaded")))}),250)},setEwayPublicApiKey:e=>{t.fields.nameFieldConfig.publicApiKey=e,t.fields.cardFieldConfig.publicApiKey=e,t.fields.expiryFieldConfig.publicApiKey=e,t.fields.cvnFieldConfig.publicApiKey=e},hasValidInputValues:function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const c=document.getElementById("securefieldcode"),r=c.closest("fieldset"),o=Object.keys(t.ewayFields),n=["card","name","expiry","cvn"];if(o.length<4){if(e){const e=n.filter((e=>!o.includes(e))),t={type:"card"===e[0]?"number":e[0]};r.dispatchEvent(new CustomEvent("wcEwaySecureFieldsValidationFail",{detail:t}))}return!1}for(const c in t.ewayFields){const o=t.ewayFields[c];if(!o.valueIsValid){if(e){const e={type:"card"===o.targetField?"number":o.targetField};r.dispatchEvent(new CustomEvent("wcEwaySecureFieldsValidationFail",{detail:e}))}return!1}}return!0}};var c=t;function r(t){const c=document.getElementById("wc-eway-credit-card-fields"),r=t.detail.type,o=(0,e.sprintf)(/* translators: 1: Credit card field type */
(0,e.__)("Your card %s is invalid.","wc-eway"),t.detail.type),n=c.querySelector(".woocommerce-error.eway-error");n&&n.remove(),c.insertAdjacentHTML("beforeend",`<ul class="woocommerce-error eway-error" role="alert" data-type="${r}"><li>${o}</li></ul>`)}function o(e){const t=document.getElementById("wc-eway-credit-card-fields"),c=e.detail.type,r=t.querySelector(`.eway-error.woocommerce-error[data-type="${c}"]`);r&&r.remove()}function n(){const e=document.getElementById("place_order");c.hasValidInputValues(!1)?e.disabled=!1:e.disabled=!0}document.addEventListener("wcEwaySecureFieldsLoaded",(()=>{if(document.querySelector(".wp-block-woocommerce-checkout"))return;const e=document.getElementById("wc-eway-credit-card-fields"),t=e.querySelector("#securefieldcode");e.addEventListener("wcEwaySecureFieldsValidationFail",r),e.addEventListener("wcEwaySecureFieldsValidationSuccess",o),t.addEventListener("change",n)})),document.addEventListener("DOMContentLoaded",(function(){const{public_api_key:t}=eway_settings,r=jQuery("#add_payment_method");r.length&&(r.on("click init_add_payment_method",(function(){const e=jQuery("#payment");"eway"===e.find('input[name="payment_method"]:checked').val()&&(e.find('iframe[name="eway-secure-card-field"]').length||(jQuery(".woocommerce-Payment").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),c.setupAllSecureFields(t)))})),document.addEventListener("wcEwaySecureFieldsLoaded",(function(){jQuery(".woocommerce-Payment").unblock()})),r.on("submit",(function(){if(""===document.getElementById("securefieldcode").value){const t=document.querySelector(".woocommerce-error.eway-error");return t&&t.remove(),r.prepend((0,e.sprintf)('<div class="woocommerce-error eway-error">%s</div>',(0,e.__)("Please enter your card details.","wc-eway"))),window.setTimeout((()=>{r.unblock(),jQuery.scroll_to_notices(jQuery(".woocommerce-error.eway-error"))}),250),!1}return!0})))})),document.addEventListener("DOMContentLoaded",(function(){const{public_api_key:t}=eway_settings,r={$checkoutForm:jQuery("form.checkout"),submit_error(e){jQuery(".woocommerce-NoticeGroup-checkout, .woocommerce-error, .woocommerce-message").remove(),r.$checkoutForm.prepend('<div class="woocommerce-NoticeGroup woocommerce-NoticeGroup-checkout">'+e+"</div>"),r.$checkoutForm.removeClass("processing").unblock(),r.$checkoutForm.find(".input-text, select, input:checkbox").trigger("validate").trigger("blur"),r.scroll_to_notices(),jQuery(document.body).trigger("checkout_error",[e])},scroll_to_notices(){let e=jQuery(".woocommerce-NoticeGroup-updateOrderReview, .woocommerce-NoticeGroup-checkout");e.length||(e=this.$checkoutForm),jQuery.scroll_to_notices(e)}};function o(t){if(t.find('input[name="threeds_enrollment_access_token"]').length||!eway_settings.is_3d_secure)return!0;const o=jQuery('.wc_payment_method.payment_method_eway input[name="eway_card_id"]:checked').val()||"new",n=jQuery('.wc_payment_method.payment_method_eway input[name="_eway_nonce"]'),d=n?n.val():"",i=document.getElementById("securefieldcode").value,a="new"===o;if(t.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),a){if(""===i||!c.hasValidInputValues())return r.$checkoutForm=t,r.submit_error((0,e.sprintf)('<div class="woocommerce-error">%s</div>',(0,e.__)("Please enter your card details.","wc-eway"))),t.removeClass("processing").unblock(),!1}else if(!Number.isInteger(parseFloat(o)))return r.$checkoutForm=t,r.submit_error((0,e.sprintf)('<div class="woocommerce-error">%s</div>',(0,e.__)("Please select valid card.","wc-eway"))),t.removeClass("processing").unblock(),!1;const l={},s=document.querySelector('input[name="woocommerce_pay"]');if(l.action=s?"wc_eway_3ds_enrollment_order_pay":"wc_eway_3ds_enrollment",l.secure_fields_token=i,l.saved_token_id=o,l._ajax_nonce=eway_settings.wc_eway_3ds_enrollment_nonce,l._eway_nonce=d,s){const e=document.querySelector('input[name="_eway_nonce"]').parentNode.querySelector('input[name="_wp_http_referer"]'),t=new URLSearchParams(e.value);l.order_key=t.get("key")}return jQuery.post(wc_checkout_params.ajax_url,l,(function(e){const c=t.find(".blockOverlay"),o=c.css("z-index");if(e.data.errors)r.$checkoutForm=t,r.submit_error('<div class="woocommerce-error">'+e.data.errors+"</div>"),t.removeClass("processing").unblock();else{c.css("z-index",1);try{Cerberus.run({accessCode:e.data.three_ds_enrollment_access_code,onComplete(){c.css("z-index",o),t.removeClass("processing").unblock(),t.append(`<input type="hidden" name="threeds_enrollment_access_token" value="${e.data.three_ds_enrollment_access_code}" />`),t.trigger("submit")}})}catch(e){console.log(e)}}})),!1}jQuery(document.body).on("payment_method_selected updated_checkout",(function(){const e=jQuery(".woocommerce-checkout").find('input[name="payment_method"]:checked');if("eway"!==e.val())return;const r=!e.closest(".wc_payment_method").find('iframe[name="eway-secure-card-field"]').length,o=document.getElementById("place_order"),n="payment_method_selected.eway_enabled_place_order_button_for_other_payment_method";jQuery(document.body).off(n).on(n,(()=>{"eway"!==jQuery(".woocommerce-checkout").find('input[name="payment_method"]:checked').val()&&(o.disabled=!1,jQuery(document.body).off(n))})),r&&(jQuery(".woocommerce-checkout-payment").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),c.setupAllSecureFields(t));const d=jQuery('.wc_payment_method.payment_method_eway input[name="eway_card_id"]:checked').val();o.disabled="new"===d})),document.addEventListener("wcEwaySecureFieldsLoaded",(()=>{document.querySelector(".wp-block-woocommerce-checkout")||jQuery(".woocommerce-checkout-payment").unblock()})),jQuery(document.body).on("change",'.wc_payment_method.payment_method_eway input[name="eway_card_id"]',(function(){const e=jQuery('.wc_payment_method.payment_method_eway input[name="eway_card_id"]:checked').val(),t=document.getElementById("place_order");"new"!==e?(jQuery("#wc-eway-credit-card-fields").hide(),t.disabled=!1):(jQuery("#wc-eway-credit-card-fields").show(),t.disabled=!0);const c=jQuery(this).closest("form").find('input[name="threeds_enrollment_access_token"]');c.length&&c.remove()})),jQuery("form.woocommerce-checkout").on("checkout_place_order_eway",(function(){return o(jQuery(this))})),jQuery("form#order_review").on("submit",(function(){return o(jQuery(this))}))}))}();